---
title: "Windowsã¨cliã§SORACOM Arcã‚’è©¦ã—ã¦ã¿ãŸ"
emoji: "ğŸ˜€"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["soracom","soracomArc","iot","cli"]
published: true
---



# ã“ã‚Œã¯

[SORACOM Discovery 2021 Onlie](https://discovery.soracom.jp/)ã§ç™ºè¡¨ã•ã‚ŒãŸã€SORACOM Arcã‚’è©¦ã—ã¦ã¿ãŸã¨ã„ã†ãŠè©±ã§ã™ã€‚



# SORACOM Arcã¨ã¯

ã–ã£ãã‚Šã„ã†ã¨ã€ä»®æƒ³SIMã‚’ç”¨ã„ã¦ã€SORACOMãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«VPNã§æ¥ç¶šã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚

ã“ã‚Œã¾ã§ã¯Beam,Funk,Funnel,Harvestã¨ã„ã£ãŸSORACOMã®è¶…çµ¶ä¾¿åˆ©ãªæ©Ÿèƒ½ã‚’ä½¿ã†ã«ã¯SORACOM Airã§æ¥ç¶šã™ã‚‹ã—ã‹ãªã‹ã£ãŸã‚ã‘ã§ã™ãŒ(Harvestã¯InventoryçµŒç”±ãŒå¯èƒ½ãªã®ã§ã¡ã‚‡ã£ã¨ä¾‹å¤–)ã€ãªã‚“ã¨ã“ã‚ŒãŒå…¨ã¦ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚



è©³ã—ãã¯[å…¬å¼ãƒšãƒ¼ã‚¸](https://users.soracom.io/ja-jp/docs/arc/feature/)ã‚’ã”è¦§ãã ã•ã„ã€‚



# Windowsã§è©¦ã™ã«ã¯

Windowsã§ã¯2021å¹´6æœˆ23æ—¥ç¾åœ¨ã€å…¬å¼ã‚³ãƒãƒ³ãƒ‰[soratun](https://users.soracom.io/ja-jp/docs/arc/soratun-overview/)ãŒå‹•ãã¾ã›ã‚“(WSL2ã§ã‚‚å‹•ãã¾ã›ã‚“ã§ã—ãŸã€‚ã‚«ãƒ¼ãƒãƒ«ã«æ¨©é™ãŒè¶³ã‚Šãªã„ï¼Ÿ)ã®ã§ã€ã“ã“ã¯[WireGuard](https://www.wireguard.com/)ã‚’ä½¿ã„ã¾ã™ã€‚

[å…¬å¼ãƒšãƒ¼ã‚¸ã®ã€ŒInstallationã€](https://www.wireguard.com/install/)ã‹ã‚‰ãƒã‚¤ãƒŠãƒªã‚’è½ã¨ã—ã¦ãã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚



# ä»®æƒ³SIMã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œã‚‹

ç¶šã„ã¦ä»®æƒ³SIMã‚’ä½œæˆã—ã€ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œã‚Šã¾ã™ã€‚ã›ã£ã‹ããªã®ã§ãƒªãƒªãƒ¼ã‚¹ã•ã‚ŒãŸã°ã‹ã‚Šã®CLI v0.10.0ã‚’ä½¿ã£ã¦ã¿ã¾ã™ã€‚

SORACOM CLI v0.10.0ä»¥é™ã‚’[ãƒªãƒªãƒ¼ã‚¹ãƒšãƒ¼ã‚¸](https://github.com/soracom/soracom-cli/releases)ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¾ã™ã€‚



ã¾ãšã¯ä»®æƒ³SIMã‚’ä½œã‚Šã¾ã™ã€‚

```bash
$ soracom sims create --type virtual --subscription planArc01
{
        "activeProfileId": "xxxxxxxxxxxxxxxxxxxx",
        "arcSessionStatus": {
                "arcAllowedIPs": [
                        "100.127.0.0/16"
                ],
                "arcClientPeerIpAddress": "xxx.xxx.xxx.xxx",
                "arcClientPeerPublicKey": "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
                "arcServerEndpoint": "xxx.arc.soracom.io:11010",
                "arcServerPeerPublicKey": "xxxxxxxxxxxxxxxxxxxxxxxxx",
                "gtpcTeid": xxxxxxxxxxxxx,
                "lastUpdatedAt": xxxxxxxxxxxx,
                "location": null
        },
.....
        "simId": "xxxxxxxxxxxxxxxxxxxx",
        "speedClass": "arc.standard",
        "status": "active",
        "tags": {},
        "terminationEnabled": true,
        "type": "virtual"
}
$ export SIMID=xxxxxxxxxxxxxxxxxxxxxx
```

ä½œæˆã™ã‚‹ã¨arcã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒåŒæ™‚ã«ä½œã‚‰ã‚Œã‚‹ã‚ˆã†ã§ã€`arcSessionStatus`ã¨ã„ã†æƒ…å ±ãŒè¿”ã£ã¦ãã¦ã„ã¾ã™ã€‚ãŸã ã—ã€ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã‚’è¶³ã—ãŸã‚ã¨ã«ä¸€æ—¦ãƒªã‚»ãƒƒãƒˆã—ãªã„ã¨ã„ã‘ãªã„ã®ã§ã“ã®æƒ…å ±ã¯ä½¿ã„ã¾ã›ã‚“ã€‚

ã¾ãŸã€ã“ã®ã‚ã¨ä½¿ã†ã®ã§`simId`ã®å€¤ã‚’ç’°å¢ƒå¤‰æ•°ã«è¨­å®šã—ã¦ãŠãã¾ã™ã€‚



***2021å¹´6æœˆ25æ—¥è¿½è¨˜***

ä»¥ä¸‹ã®æ‰‹é †ãŒå®Ÿã¯ä¸è¦ã§ã‚ã£ãŸã“ã¨ã«æ°—ãŒã¤ãã¾ã—ãŸã®ã§ã€æœ«å°¾ã®è¨‚æ­£è¨˜äº‹ã‚’ã”è¦§ãã ã•ã„ã€‚`sims create`ã§æˆ»ã£ã¦ããŸæƒ…å ±ã«å«ã¾ã‚Œã‚‹ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ã¨ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«æƒ…å ±ã ã‘ã§ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã§ãã¾ã™ã€‚

***è¿½è¨˜ã“ã“ã¾ã§***



ç¶šã„ã¦ã€ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã‚’ä½œã‚Šã¾ã™ã€‚

```bash
$ soracom sims attach-arc-credentials --sim-id $SIMID
{
        "arcClientPeerPrivateKey": "xxxxxxxxxxxxxxxxxxxxxxxxxxx",
        "arcClientPeerPublicKey": "xxxxxxxxxxxxxxxxxxxxxxxxxxx"
}
```



ãã—ã¦ã€ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã‚’è¿½åŠ ã—ãŸã®ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã€‚

```bash
$ soracom sims create-arc-session --sim-id $SIMID
{
        "arcAllowedIPs": [
                "100.127.0.0/16"
        ],
        "arcClientPeerIpAddress": "xxx.xxx.xxx.xxx",
        "arcClientPeerPublicKey": "xxxxxxxxxxxxxxxxxxxxxxxxx",
        "arcServerEndpoint": "xxxx.arc.soracom.io:11010",
        "arcServerPeerPublicKey": "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
}
```



# WireGuardã®è¨­å®šã‚’ã™ã‚‹

WireGuardã®è¨­å®šã‚’ã—ã¾ã™ã€‚ãƒˆãƒ³ãƒãƒ«ã®è¨­å®šã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/d52d8ee984e2134bb8ca02a9.png)



- `PrivateKey`ã«ã¯`attach-arc-credentials`ã‚³ãƒãƒ³ãƒ‰ã®æˆ»ã‚Šå€¤ã®`arcClientPeerPrivateKey`ã‚’å…¥ã‚Œã¾ã™
- `Address`ã«ã¯`create-arc-session`ã‚³ãƒãƒ³ãƒ‰ã®æˆ»ã‚Šå€¤ã®`arcClientPeerIpAddress`ã®å¾Œã‚ã«`/32`ã‚’ã¤ã‘ãŸã‚‚ã®ã‚’å…¥ã‚Œã¾ã™
- `PublicKey`ã«ã¯`create-arc-session`ã‚³ãƒãƒ³ãƒ‰ã®æˆ»ã‚Šå€¤ã®`arcClientPeerPublicKey`ã‚’å…¥ã‚Œã¾ã™
- `AllowedIPs`ã«ã¯`create-arc-session`ã‚³ãƒãƒ³ãƒ‰ã®æˆ»ã‚Šå€¤ã®`arcAllowedIPs`ã‚’å…¥ã‚Œã¾ã™
- EndPointã«ã¯`create-arc-session`ã‚³ãƒãƒ³ãƒ‰ã®æˆ»ã‚Šå€¤ã®`arcServerEndpoint`ã‚’ãƒãƒ¼ãƒˆç•ªå·ã¾ã§å…¥ã‚Œã¾ã™ã€‚



ã“ã“ã¾ã§ã§ããŸã‚‰ã€Œæœ‰åŠ¹åŒ–ã€ã‚’æŠ¼ã—ã¦ã€`pong.soracom.io`ã«pingã‚’æ‰“ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

![](https://storage.googleapis.com/zenn-user-upload/5fb504dd7e0b267b732c0a8d.png)

![](https://storage.googleapis.com/zenn-user-upload/5fbd56858d3e089261f6c1bb.png)



ã†ã¾ãã„ãã¾ã—ãŸã­ï¼

ä¸€é€£ã®æµã‚Œã‚’å®Ÿæ–½ã—ã¦è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ãå‡ºã™ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¨ã—ã¦ã¯ã“ã‚“ãªæ„Ÿã˜ã§ã—ã‚‡ã†ã‹ã€‚



```bash
#!/bin/sh
simId=`soracom sims create --type virtual --subscription planArc01 | jq -r .simId`
privateKey=`soracom sims attach-arc-credentials --sim-id $SIMID | jq -r .arcClientPeerPrivateKey`
session=`soracom sims create-arc-session --sim-id $SIMID`
allowedIPs=`echo $session | jq -r .arcAllowedIPs[0]`
address=`echo $session | jq -r .arcClientPeerIpAddress`
publicKey=`echo $session | jq -r .arcServerPeerPublicKey`
endpoint=`echo $session | jq -r .arcServerEndpoint`

echo "[Interface]"
echo "PrivateKey = $privateKey"
echo "Address = ${address}/32"
echo
echo "[Peer]"
echo "PublicKey = $publicKey"
echo "AllowedIPs = $allowedIPs"
echo "Endpoint = $endpoint"
```

ã“ã®å‡ºåŠ›çµæœã‚’WireGuardã«è²¼ã‚Šä»˜ã‘ã‚Œã°ã„ã‘ã‚‹ã¨æ€ã„ã¾ã™(æœªæ¤œè¨¼)



# è¨‚æ­£(2021å¹´6æœˆ25æ—¥è¿½è¨˜)

å†åº¦ç¢ºèªã—ãŸã¨ã“ã‚ã€æœ€åˆã®`sims create`ã‚’ã—ãŸæ™‚ç‚¹ã§æ—¢ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ã¨ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ãŒå«ã¾ã‚Œã¦ã„ã¾ã—ãŸã€‚

```json
{
        "activeProfileId": "xxxxxxxxxxxxxxxxxxxxxxx",
        "arcSessionStatus": {
                "arcAllowedIPs": [
                        "100.127.0.0/16"
                ],
                "arcClientPeerIpAddress": "xxx.xxx.xxx.xxx",
                "arcClientPeerPublicKey": "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
                "arcServerEndpoint": "xxx.arc.soracom.io:11010",
                "arcServerPeerPublicKey": "xxxxxxxx",
                "lastUpdatedAt": xxxxxxxxxxxxxxxxxxxx
        },
......    
        "profiles": {
                "xxxxxxxxxxxxxxxxxxxxxxxxxxxxx": {
                        "arcClientPeerPrivateKey": "xxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
                        "arcClientPeerPublicKey": "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
                        "iccid": "xxxxxxxxxxxx",
.......
                },
........            
         "type": "virtual"
}
```

ã“ã‚“ãªæ„Ÿã˜ã§ã™ã­ã€‚ãªã®ã§ã€ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚‚ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚Šã¾ã™ã€‚

`-i`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§æ—¢å­˜ã®simIDã‚’æ¸¡ã™ã¨ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã®è¿½åŠ ã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ãƒªã‚»ãƒƒãƒˆã‚’ã‚„ã‚Šã€ãªã„å ´åˆã¯ä»®æƒ³SIMã‚’ä½œã‚Šã¾ã™ã€‚

```bash
#!/bin/sh
simId="non"

while getopts i: OPT
do
  case $OPT in
    i) simId=$OPTARG
      ;;
  esac
done

if [ $simId = "non" ]; then
  created=`soracom sims create --type virtual --subscription planArc01`
  simId=`echo $created | jq .simId`
  privateKey=`echo $created | jq -r .profiles.${simId}.arcClientPeerPrivateKey`
  session=`echo $created | jq -r .arcSessionStatus`
else
  privateKey=`soracom sims attach-arc-credentials --sim-id $simId | jq -r .arcClientPeerPrivateKey`
  session=`soracom sims create-arc-session --sim-id $simId`
fi
allowedIPs=`echo $session | jq -r .arcAllowedIPs[0]`
address=`echo $session | jq -r .arcClientPeerIpAddress`
publicKey=`echo $session | jq -r .arcServerPeerPublicKey`
endpoint=`echo $session | jq -r .arcServerEndpoint`

echo "[Interface]"
echo "PrivateKey = $privateKey"
echo "Address = ${address}/32"
echo
echo "[Peer]"
echo "PublicKey = $publicKey"
echo "AllowedIPs = $allowedIPs"
echo "Endpoint = $endpoint"
```

# ã¾ã¨ã‚

SORACOM Arcã¯ã€SORACOM Airã‚’ä½¿ã‚ãšã«SORACOMã®å„ç¨®ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ãˆã‚‹ã¨ã„ã†è¶…ç´ æ•µã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚ãƒ‡ãƒãƒƒã‚°ã¯ã‚‚ã¡ã‚ã‚“ã€å¿œç”¨ç¯„å›²ã¯å¤šå²ã«ã‚ãŸã‚Šã¾ã™ã€‚Napterã¨çµ„ã¿åˆã‚ã›ã¦VPNã‚’æ§‹ç¯‰ã—ãŸã‚Šã‚‚ç°¡å˜ã«ã§ããã†ã§ã™ã­ã€‚ã“ã‚Œã‹ã‚‰ã‚‚è‰²ã€…ã¨ä½¿ã£ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚



æ‹™ä½œã®[LTE-M Button Simulator](https://zenn.dev/showm001/articles/2021-06-19-01)ã¨çµ„ã¿åˆã‚ã›ã¦ç°¡å˜ã«ãƒãƒ³ã‚ºã‚ªãƒ³ã‚‚ã§ãã¾ã™ã­ï¼



